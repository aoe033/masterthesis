%location/filename: tex/fig/flow_tx.tex
%author: Anders Ã˜stevik
%Last edited: 19.05.2016
%#######--Flowchart for rs232 transmitt function--#######
%

\documentclass[main.tex]{subfiles}

\usetikzlibrary{shapes.geometric, arrows}

\begin{document}

\begin{figure}[!t]
\begin{center}
%\usetikzlibrary{arrows,automata}
\begin{tikzpicture}[>=stealth',shorten >=1pt,auto,node distance=4cm]
  \node[initial,state] (idle)      {\small{\textit{idle}}};
  \node[state,accepting]         (read1) [right of=idle]  {\small{\textit{read1}}};
  \node[state]         (wait1) [right of=read1] {\small{\textit{wait1}}};
  \node[state,accepting]         (read2) [right of=wait1] {\small{\textit{read2}}};
 
  %\path[->]          (S)  edge [loop above] node {a} (idle);
  \path[->]          (idle)  edge [loop above] node {\small {\textit {uart-reset count}}} (idle);
  \path[->]           (idle)  edge              node {\small{\textit{rx\_empty = '0'}}} (read1);
  \path[->]          (read1);
  \path[->] (read1) edge             node {\small{\textit{byte = request}}} (wait1);
  \path [->]             (wait1) edge [loop above] node {\small{\textit{timeout count}}} (wait1);
  \path[->] (wait1) edge             node {\small{\textit{rx\_empty = '0'}}} (read2);
  \path [->]             (read2)
             edge [in=-90,out=-120,above,distance=2cm]  node[align=center] {
             \small{\textit{}}
             } (idle);
  \path [->]             (wait1)
             edge [in=60,out=120,above,distance=1cm]  node[align=center] {
             \small{\textit{Timeout!}}
             } (idle);          
  \path [->] (read1)
             edge [bend left]  node[align=center] {
             \small{\textit{byte /= request}}
             } (idle);
\end{tikzpicture}
\caption{\gls{uart} decoder state machine.}
\label{fig:uartdec}
\end{center}
\end{figure}  

\end{document}